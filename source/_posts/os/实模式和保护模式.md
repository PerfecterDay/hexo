---
title: 分页机制
date: 2018-05-30 19:50:07
tags: os
category: os
---

# 实模式
x86架构的cpu在启动时都是进入的实模式，实模式的特点是：
0. 指令的寻址方式不同，操作数一般16位。
1. 16位的寄存器，20位地址线，最大只能访问1M内存。
2. 内存访问方式是段地址*16+偏移地址构成内存的物理地址，且可以通过在程序中修改段基址来访问任意的真实物理内存，并修改。这样用户程序与系统程序一样，拥有至高无上的权利甚至可以修改操作系统的内存。
3. 因为只有16位寄存器，所以一个段最多只能是64KB大小，超过这个大小就要切换段基址来访问更大范围的内存区域。
4. 一次只能运行一个程序。

写一个实模式的程序，你要了解你的程序将会被加载到内存的什么位置，然后将合适的段加载到内存中合适的位置（没有被他人占用），并且初始化各个数据段寄存器的值，以保证其正确地指向各个段基址。

# 保护模式
0. 指令寻址方式扩展。操作数扩展到32位。
1. 寄存器扩展到32位，地址总线和数据总线为32位。
2. 通过段描述符来描述一段内存，包括段基址、段大小、特权级、权限、属性等等。许多描述符组成全局段描述符表，存储在内存中。 每个段描述符8个字节。
3. GDTR48位寄存器保存GDT全局描述符表在内存中的段基址及大小，前32位为GDT在内存中的起始地址，后16位为GDT的大小。所以段描述符表最多存储2^16/2^3=2^13个段。
4. 每个程序都可以在全局描述符表中定义自己的段描述符。
5. 保护模式下的段寄存器叫做段选择子，0~1位用来存储RPL(请求特权级),第2位代表是在GDT还是在LDT中，3~15位为索引，表示在GDT或者LDT表中的索引。