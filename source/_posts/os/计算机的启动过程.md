---
title: 计算机启动过程
date: 2018-05-19 10:46:07
tags: os
category: os
---

# 计算机的启动过程
计算机的大脑是CPU，CPU的PC(程序计数器)会指向CPU下一次执行的指令，PC是一种笼统的说法。不同的CPU的实现方式不同，x86 CPU的cs:ip寄存器的实现PC，cs:ip不允许直接赋值，只能通过jmp、call、int、ret等指令修改，但是有些CPU是通过不同的方式实现PC的，如ARM架构的CPU，它有一个寄存器就叫pc，且可以使用mov指令直接为pc赋值：mov pc, r0。

x86 CPU有实模式和保护模式之分，刚刚开始启动时是在实模式下运行的，操作系统运行之后，通过指令将其切换到保护模式下运行。

## 实模式下的内存布局
![实模式下的内存布局](/pics/memory.jpg)


## 启动过程
x86 CPU加电后，cs：ip分别被初始化为0xF000:0xFFF0,实模式下内存访问为：段基址\*16+段便宜地址，因此有效地址即为：0xFFFF0,即为上图中的BIOS的地址。BIOS在这16B字节中只有一条跳转指令，jmp far f000:e05b,即0xfe05b处,此处是BIOS代码真正开始的地方。

BIOS完成检测内存、基本硬件的检测，然后建立中断向量表、填写中断历程等。

BIOS最后一步是校验启动盘中0盘0道1扇区的内容。并将其加载到0x7c00处，然后跳转到0x7c00处开始执行mbr代码。

MBR代码负责加载操作系统内核。