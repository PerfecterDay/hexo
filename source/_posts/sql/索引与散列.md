---
title: 索引与散列
date: 2018-06-11 15:18:20
tags: sql
category: sql
---
## 基本概念
顺序索引：基于值的顺序索引。
散列索引：基于将值通过散列函数平均分布到若干散列桶中。

## 顺序索引
每个索引结构与一个特定的搜索码相关联。正如书中的索引或者图书馆目录一样，顺序索引按照顺序存储搜索码的值，并将每个搜索码与包含该搜索码的记录关联起来。

被索引文件中的记录自身也可以按照某种排序顺序存储，正如图书馆的书按某些属性顺序排放一样。一个文件可以有多个索引，分别基于不同的搜索码。如果包含记录的文件按照某个搜索码索引指定的顺序将记录排序，那么该搜索码对应的索引成为**聚集索引**，也称为**主索引**。搜索码指定的顺序与文件中记录的物理顺序不同的索引称为**非聚集索引**或**辅助索引**。

在搜索码上有聚集索引的文件称为**索引顺序文件**。

### 稠密索引和稀疏索引
**索引项**或**索引记录**由一个搜索码值和指向具有该搜索码值的一条或多条记录的指针构成。指向记录的指针包括磁盘块的标识和标识磁盘块内记录的块内偏移量。

可以使用的顺序索引有两类：

* 稠密索引：在稠密索引中，文件中的每个搜索码值都有一个索引项。在稠密聚集索引中，索引项包括搜索码值以及指向具有该搜索码值第一条数据记录的指针。具有相同搜索码值的其余记录顺序地存储在第一条数据记录之后，由于该索引是聚集索引，因此记录根据相同的搜索码值排序。

在稠密非聚集索引中，索引必须存储指向所有相同搜索码值的记录的指针列表。

* 稀疏索引：在稀疏索引中，只为搜索码的某些值建立索引项。只有当关系按搜索码排列顺序存储记录时才能使用稀疏索引，换句话说，只有索引是**聚集索引**时才能使用稀疏索引。为了使用索引查找一条记录，首先找到小于或等于待查搜索码值的索引项，然后从该索引项指向的记录开始，沿着文件中的记录指针查找知道找到所需记录为止。
![稀疏索引和稠密索引](/pics/index.png)

因为，稠密索引为每个不同的搜索码都建立了索引项，利用稠密索引通常可以更快地定位一条记录。但是，稀疏索引也有优越的地方：它所占的存储空间较小，并且插入和删除时所需的维护开销也较小。

系统设计者必须在存取时间和空间开销之间进行权衡，尽管这一权衡的决定依赖于具体的应用，但是为每个块建立一个索引项的稀疏索引是一个较好的折中。利用稀疏索引快速定位到块后，将块读取到内存，在内存中扫描整个块的时间与定位磁盘块的时间相比可以忽略。只要记录不在溢出块中，就能使块访问次数最小，同时保持索引尽可能的小。

**文件中的记录按照A搜索码有序排列，没有按B搜索码有序排列。那么，A搜索码上的索引称为聚集索引（可以是稠密也可以是稀疏的），在B搜索码的上的为辅助索引（稠密索引）。
如为每个记录搜索码建立索引项就是稠密索引，反之就是稀疏索引。**

### 辅助索引
辅助索引必须是稠密索引，对每个搜索码值都要有一个索引项，而且对文件中的每条记录都有一个指针。而聚集索引可以是稀疏索引，只要找到一个合适的记录，然后顺序扫描部分文件即可找到指定记录。但是，非聚集索引不能是稀疏的，因为搜索码乱序排放，所以有可能造成整个文件扫描才能找到指定记录。
