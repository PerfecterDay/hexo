---
title: sql查询的基本结构
date: 2018-06-14 20:34:45
tags: sql   
category: sql
---

## 查询
一个sql查询包括三种类型子句： **select** 子句、 **from** 子句、 **where** 子句：

1. **select** 子句用于列出查询结果中所需要的属性
2. **from** 子句是一个查询求值中要访问的关系列表
3. **where** 子句是一个作用在 **from** 子句中关系上的谓词。
一个典型的sql查询具有如下形式：

![sql查询的基本结构](/pics/select-1.jpg)

每个`A<sub>i</sub>`代表一个属性，每个`r<sub>i</sub>`代表一个关系，P是一个谓词，如果省略 **where** 子句，那么谓词P为true。

通常来说，一个SQL查询的含义可以理解如下：

1. 为**from**子句中列出的关系产生笛卡尔积
2. 在步骤1的基础上应用 **where** 子句中指定的谓词
3. 在步骤2结果中的每个元组，输出 **select** 子句中指定的属性(或表达式结果)。

![笛卡尔积](/pics/dikaer.jpg)


## 复杂查询
包含聚集、**group by**或**having**子句的查询的含义可通过下述操作序列来定义：

1. 与不带聚集的查询情况类似，最先根据 **from** 子句计算出一个关系； 
2. 如果出现 **where** 子句，**where** 子句中的谓词将应用到 **from** 子句的结果关系上； 
3. 如果出现了**group by**子句， 满足 **where** 谓词的元组通过**group by**子句形成分组。 如果没有 **group by** 子句，满足 **where** 谓词的整个元组集被当做一个分组。 
4. 如果出现了 **having** 子句，它将应用到每个分组上；不满足 **having** 子句谓词的分组将被抛弃。 
5. **select**子句 利用剩下的分组产生出查询结果中的元组，即在每个分组上应用聚集函数来得到单个结果元组。

出现在 **select** 语句中但没有被聚集的属性，只能是那些出现在 **group by** 子句中那些的属性。换句话说，任何没有出现在 **group by** 子句中的属性，如果出现在 **select** 子句中，**它只能出现在聚集函数内部**，否则这样的查询就是错误的。

与 **select** 子句任何出现在 **having** 子句中，但没有被聚集的属性必须出现在 **group by** 子句中，否则查询就被当成错误的。

## 对空值和布尔值的聚集
除了 **count(\*)** 外的所有聚集函数都**忽略**输入集合中的空值。