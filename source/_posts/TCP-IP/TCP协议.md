---
title: TCP 协议
date: 2019-12-19  22:45:26
tags: tcp/ip
category: tcp/ip
---
#### TCP服务概述
TCP提供一种面向连接的、可靠的字节流服务。
面向连接意味着两个使用TCP的应用在彼此交换数据之前必须先建立一个TCP连接
TCP通过下列方式来提供可靠性：
    1. 应用数据被分割成TCP认为最适合发送的数据块，对比UDP，UDP不会处理应用程序产生的数据报。
    2. 确认机制：接收方收到一个报文段后会向发送方发送一个确认，告诉对方收到了报文段。
    3. 超时重传：TCP发出一个报文段后，启动一个定时器，如果在超时之前没有收到接收方的确认，将会重发这个报文段。
    4. 校验机制：TCP将保持它首部和数据的检验和。如果收到段的检验和有差错，TCP将丢弃这个报文段，也不确认收到此报文段（希望发端超时并重发）
    5. 保证有序：IP数据报的到达可能会失序，因此TCP报文段的到达也可能会失序，如果必要，TCP将对收到的数据进行重新排序，将收到的数据以正确的顺序交给应用层。
    6. 保证无重复：IP数据报会发生重复， TCP的接收端会丢弃重复的数据。
    7. 流量控制：TCP连接的每一方都有固定大小的缓冲空间。TCP的接收端只允许另一端发送接收端缓冲区所能接纳的数据。这将防止较快主机致使较慢主机的缓冲区溢出。

#### TCP首部
![TCP首部格式](/pics/tcp.png)
+ URG：紧急指针有效
+ ACK：确认序号有效。
+ PSH：接收方应该尽快将这个报文段交给应用层。
+ RST：重建连接。
+ SYN：同步序号用来发起一个连接。这个标志和下一个标志将在第1 8章介绍。
+ FIN：发端完成发送任务。
#### TCP半关闭
TCP提供了连接的一端在结束它的发送后还能接收来自另一端数据的能力。这就是所谓的半关闭。

![TCP状态变迁图](/pics/tcp-status.png)
