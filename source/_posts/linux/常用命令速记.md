---
title: 常用命令速记
date: 2018-09-05  21:05:38
tags: linux            
category: linux
---
### su 和 sudo
su [user]: 切换到 [user] 用户，需要输入切换到的用户的密码，省略 user 的话默认切换到 root 用户。执行完 命令后，使用 exit 切换到原用户。

su - 与 su 的区别：两者都是切换到root 用户，但是前者会连shell 环境一起切换。

`sudo [command]`: 以 root 权限执行命令，需要输入当前用户的密码，一般成功后15分钟内 sudo 无需再输入密码。但是这些都是由配置文件`/etc/sudoers`来进行授权的，就是说如果用户没有sudo权限，也是无法执行该命令的。 可以使用 visudo 命令修改其中的配置。

示例配置：`root  ALL=(ALL)  ALL -> 用户  允许登陆的主机位置=（可以切换的账户） 可以执行的命令`: 该配置表示root用户在任意位置切换到任意账户执行任意命令。

`%admin	 ALL = (ALL) ALL ->  用户组 允许登陆的主机位置=（可以切换的账户） 可以执行的命令`:  admin用户组在任意位置切换到任意账户执行任意命令。

### 系统状态查看
0. `pgrep`：查看进程
1. `arch`:显示架构
2. `uname -a`:查看Linux系统版本
3. 查看某个时间点的进程信息-`ps`:`ps -lef`
    + UID：启动这些进程的用户。
    + PID：进程的进程ID。 
    + PPID：父进程的进程号（如果该进程是由另一个进程启动的）。
    + C：进程生命周期中的CPU利用率。
    + STIME：进程启动时的系统时间。
    + TTY：进程启动时的终端设备。
    + TIME：运行进程需要的累计CPU时间。
    + CMD：启动的程序名称。
    + F：内核分配给进程的系统标记。
    + S：进程的状态（ O代表正在运行； S代表在休眠； R代表可运行，正等待运行； Z代表僵化，进程已结束但父进程已不存在； T代表停止）。
    + PRI：进程的优先级（越大的数字代表越低的优先级）。
    + NI：谦让度值用来参与决定优先级。
    + ADDR：进程的内存地址。
    + SZ：假如进程被换出，所需交换空间的大致大小。
    + WCHAN：进程休眠的内核函数的地址。  

4. 实时信息-`top`

    top命令跟ps命令相似，能够显示进程信息，但它是实时显示的。

    输出的第一部分显示的是系统的概况：
    第一行显示了当前时间、系统的运行时间、登录的用户数以及系统的平均负载（1分钟、5分钟和15分钟的平均负载）。

    下一行显示了CPU的概要信息。 top根据进程的属主（用户还是系统）和进程的状态（运行、
    空闲还是等待）将CPU利用率分成几类输出。

    紧跟其后的两行说明了系统内存的状态。第一行说的是系统的物理内存：总共有多少内存，
    当前用了多少，还有多少空闲。后一行说的是同样的信息，不过是针对系统交换空间（如果分配
    了的话）的状态而言的。

    最后一部分显示了当前运行中的进程的详细列表，有些列跟ps命令的输出类似
    + PID：进程的ID。
    + USER：进程属主的名字。
    + PR：进程的优先级。
    + NI：进程的谦让度值。
    + VIRT：进程占用的虚拟内存总量。
    + RES：进程占用的物理内存总量。
    + SHR：进程和其他进程共享的内存总量。
    + S：进程的状态（ D代表可中断的休眠状态， R代表在运行状态， S代表休眠状态， T代表跟踪状态或停止状态， Z代表僵化状态）。
    + %CPU：进程使用的CPU时间比例。
    + %MEM：进程使用的内存占可用内存的比例。72 第 4 章 更多的 bash shell 命令
    + %id：空闲CPU时间百分比，如果这个值过低，表明系统CPU存在瓶颈；
    + %wa：等待I/O的CPU时间百分比，如果这个值过高，表明IO存在瓶颈；
    + TIME+：自进程启动到目前为止的CPU时间总量。
    + COMMAND：进程所对应的命令行名称，也就是启动的程序名

    进入top交互界面后，可以使用下面的键进行操作：
    1. 按E键可以切换上面概况的内存单位（KB/MB/GB），下边进程的详细信息按e键切换。  
    2. -p [pid]：可以显示指定进程的信息  
    3. P：根据CPU使用百分比大小进行排序。
    4. M：根据驻留内存大小进行排序。
    5. i：使top不显示任何闲置或者僵死进程。

5. 结束进程-`kill/killall`

    在Linux中，进程之间通过信号来通信。进程的信号就是预定义好的一个消息，进程能识别
    它并决定忽略还是作出反应。进程如何处理信号是由开发人员通过编程来决定的。大多数编写完
    善的程序都能接收和处理标准Unix进程信号。
    |信号|名称|描述|
    |--|:--:|--|
    |1 |HUP| 挂起
    |2 |INT| 中断
    |3 |QUIT| 结束运行
    |9 |KILL| 无条件终止
    |11 |SEGV| 段错误
    |15 |TERM|尽可能终止
    |17 |STOP| 无条件停止运行，但不终止
    |18 |TSTP| 停止或暂停，但继续在后台运行
    |19 |CONT| 在STOP或TSTP之后恢复执行

    `kill -9 pid`  
    killall 不仅支持pid参数，还支持通配符：`killall http*`

4. 磁盘/文件管理/内存
   1. 查看磁盘空间使用情况: `df -h`
   2. 查看当前目录所占空间大小: `du -sh`
   3. 打包：`tar -cvf etc.tar /etc <==仅打包，不压缩！` -c :打包选项, -v :显示打包进度, -f :使用档案文件
   4. 解包：`tar -xvf demo.tar`  -x:解包选项  -z:解压gz文件  -j:解压bz2文件  -J:解压xz文件
   5. 压缩文件：`gzip demo.txt`
   6. 解压缩文件：`gunzip demo.tar.gz`
   7. iostat工具
      1. -C 显示CPU使用情况
      2. -d 显示磁盘使用情况
      3. -k 以 KB 为单位显示
      4. -m 以 M 为单位显示
      5. -N 显示磁盘阵列(LVM) 信息
      6. -n 显示NFS 使用情况
      7. -p[磁盘] 显示磁盘和分区的情况
      8. -x 显示详细信息
      + 如果%iowait的值过高，表示硬盘存在I/O瓶颈。
      + 如果 %util 接近 100%，说明产生的I/O请求太多，I/O系统已经满负荷，该磁盘可能存在瓶颈。
      + 如果 svctm 比较接近 await，说明 I/O 几乎没有等待时间；
      + 如果 await 远大于 svctm，说明I/O 队列太长，io响应太慢，则需要进行必要优化。
      + 如果avgqu-sz比较大，也表示有大量io在等待。

5. 性能监控
   1. top
   2. CPU使用率： `sar [-u|-r|-q] 1 2` 每秒采样一次，总共采样2次; -r:显示内存; -q:查看运行队列中的进程数、系统上的进程大小、平均负载等
   3. 查看内存用量：`free -m` MB为单位显示
   4. 查看cpu、内存、使用情况：`vmstat n m` （n 为监控频率、m为监控次数）

6. 网络监控
   1. `netstat [-atlp]` : -a：所有端口；-t:tcp；-l:监听的状态；-p:pid信息
   2. `lsof` :列出当前系统打开文件的工具; `-i [tcp|udp:端口]`查看某个tcp/udp端口被哪个进程占用；`-p pid`查看pid进程打开的文件和端口
   3. `route -n` :查看路由状态
   4. `traceroute IP` :探测前往地址IP的路由路径
   5. `host domain` :DNS查询,寻找域名domain对应的IP；也可以使用 nslookup
   6. `host ip` :查看IP对应的域名
   7. `scp localpath ID@host:path` :将本地localpath指向的文件上传到远程主机的path路径
   8. `scp -r ID@site:path localpath` :遍历下载path路径下的整个文件系统，到本地的localpath
