---
title: Linux权限
date: 2019-06-11  22:01:23
tags: linux            
category: linux
---
## Linux的安全性
Linux安全系统的核心是用户账户。每个能进入Linux系统的用户都会被分配一个唯一的用户账户。用户系统对系统中各种对象的访问权限取决于他们登录系统时用的账户。

用户权限是通过创建用户时分配的用户ID（UID）来跟踪的，每个用户都会有一个UID和一个对应的密码

### /etc/passwd 文件
Linux系统使用一个专门的文件栏来将用户的登录名匹配到UID值，这个文件就是 /etc/passwd 文件。它包含了以下信息：
+ 登录用户名
+ 用户密码
+ UID
+ GID（用户组ID）
+ 用户账户的文本描述
+ 用户HOME目录的位置
+ 用户默认的Shell
root用户账户是Linux系统的管理员，固定分配的UID是0。Linux系统会为各种各样的功能创建不同的用户账户，这些账户不是真正的账户。它们叫做系统账户，是系统上运行各种服务进程访问资源的特殊账户。所有运行在后台的服务都需要一个系统用户登录到Linux系统上。通常系统账户的UID是500以下的值。

 /etc/passwd 文件中用户密码都被设置成了x，真实的密码被保存到了 /etc/shadow 文件中，只有特定的程序（比如登录程序）才能访问这个文件。

 ### /etc/shadow 文件
/etc/shadow文件对Linux系统密码管理提供了更多的控制。只有root用户才能访问/etc/shadow
文件，这让它比起/etc/passwd安全许多。

/etc/shadow文件为系统上的每个用户账户都保存了一条记录。记录就像下面这样：
`rich:$1$.FfcK0ns$f1UgiyHQ25wrB/hykCn020:11627:0:99999:7:::`

在/etc/shadow文件的每条记录中都有9个字段：
+ 与/etc/passwd文件中的登录名字段对应的登录名
+ 加密后的密码
+ 自上次修改密码后过去的天数密码（自1970年1月1日开始计算）
+ 多少天后才能更改密码
+ 多少天后必须更改密码
+ 密码过期前提前多少天提醒用户更改密码
+ 密码过期后多少天禁用用户账户
+ 用户账户被禁用的日期（用自1970年1月1日到当天的天数表示）
+ 预留字段给将来使用

## 用户管理
### 添加新用户
用来向Linux系统添加新用户的主要工具是 `useradd`,需要root权限或 sudo 。这个命令简单快捷，可以一次性创建新用户账户及设置用户HOME目录结构。`useradd` 命令使用系统的默认值以及命令行参数来设置用户账户。系统默认值被设置在 `/etc/default/useradd` 文件中。可以使用加入了 -D 选项的 `useradd`
命令查看所用Linux系统中的这些默认值。
```
# /usr/sbin/useradd -D
GROUP=100 新用户会被添加到GID为 100 的公共组
HOME=/home 新用户的HOME目录将会位于/home/loginname
INACTIVE=-1 新用户账户密码在过期后不会被禁用
EXPIRE=   新用户账户未被设置过期日期
SHELL=/bin/bash 新用户账户将bash shell作为默认shell
SKEL=/etc/skel 系统会将/etc/skel目录下的内容复制到用户的HOME目录下
CREATE_MAIL_SPOOL=yes  系统为该用户账户在mail目录下创建一个用于接收邮件的文件
```
倒数第二个值很有意思。 useradd 命令允许管理员创建一份默认的HOME目录配置，然后把
它作为创建新用户HOME目录的模板。这样就能自动在每个新用户的HOME目录里放置默认的系
统文件。在Ubuntu Linux系统上，/etc/skel目录有下列文件：
+ .bash_logout
+ .bashrc
+ .profile

### 删除用户
如果你想从系统中删除用户， `userdel` 可以满足这个需求。默认情况下， `userdel` 命令会只
删除 `/etc/passwd` 文件中的用户信息，而不会删除系统中属于该账户的任何文件。要删除用户的 home 目录，加上 -r 选项即可。

### 修改用户
用户账户修改工具：

命令 | 描述
|-|-|
|usermod |修改用户账户的字段，还可以指定主要组以及附加组的所属关系|
|passwd | 修改已有用户的密码|
|chpasswd | 从文件中读取登录名密码对，并更新密码|
|chage | 修改密码的过期日期|
|chfn | 修改用户账户的备注信息|
|chsh | 修改用户账户的默认登录shell|

#### usermod
`usermod` 命令是用户账户修改工具中最强大的一个。它能用来修改/etc/passwd文件中的大部分字段，只需用与想修改的字段对应的命令行参数就可以了。参数大部分跟 useradd 命令的参数一样（比如， -c 修改备注字段， -e 修改过期日期， -g 修改默认的登录组）。除此之外，还有另外一些可能派上用场的选项:
+ -l: 修改用户账户的登录名
+ -L: 锁定账户，使用户无法登录
+ -p: 修改账户的密码
+ -U: 解除锁定，使用户能够登录

#### passwd 和 chpasswd
只用 passwd 命令，它会改你自己的密码。系统上的任何用户都能改自己的密码，但只有root用户才有权限改别人的密码。

如果需要为系统中的大量用户修改密码， chpasswd 命令可以事半功倍。 chpasswd 命令能从标准输入自动读取登录名和密码对（由冒号分割）列表，给密码加密，然后为用户账户设置。你也可以用重定向命令来将含有 userid:passwd 对的文件重定向给该命令。
`# chpasswd < users.txt`

## Linux 组

### /etc/group 文件
与用户账户类似，组信息也保存在系统的一个文件中。/etc/group文件包含系统上用到的每个组的信息。系统账户用的组通常会分配低于500的GID值，而用户组的GID则会从500开始分配。/etc/group文件有4个字段：
+ 组名
+ 组密码
+ GID
+ 属于该组的用户列表
查看用户所属组信息：`groups`|`grooups [username]`.

### 创建新组
`groupadd`  命令可在系统上创建新组。
```
groupadd shared
usermod -G shared test #添加用户 test 到 shared 组
```
### 修改组
`groupmod` 命令可以修改组：
+ -g: 修改GID
+ -n: 修改组名
